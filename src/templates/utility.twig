{% include "cachewarmer/cache-warmer" %}

{% js %}
	var max_execution_time = {{ max_execution_time }};
	var total_urls = {{ total_urls }};
	var max_urls = {% if max_urls %}{{ max_urls }}{% else %}''{% endif %};
	var max_processes = {{ max_processes }};

	$(document).ready(function(){
		new Craft.CacheWarmer.Modal('#cachewarmer-modal');
		let modal = $('#cachewarmer-modal').data('modal');
		let cachewarmer = new CacheWarmer(max_execution_time, total_urls, max_urls, max_processes, modal, true);
		$('.warmthemup').click(function(){
			modal.show();
			cachewarmer.run().done(function(results){
				modal.addResults(results);
			}).fail(function(response){
				modal.hide();
				Craft.cp.displayError(response.responseJSON.error);
				$('.break-lock').fadeIn('fast');
			});
		});
		$('.break-lock button').click(function(){
			cachewarmer.unlock().done(function(data){
				Craft.cp.displayNotice(data.message);
				$('.break-lock').fadeOut('fast');
			});
		});
	});
{% endjs %}
